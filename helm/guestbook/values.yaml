# =============================================================================
# Maria Guestbook - Helm Values
# =============================================================================
# This is the main configuration file for the Guestbook application.
# Changes here are automatically deployed by ArgoCD.
#
# Teacher: To test GitOps, modify replicaCount values and commit.
# =============================================================================

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  # Image pull secrets for private registries
  imagePullSecrets: []

# -----------------------------------------------------------------------------
# Network Policies (Security)
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: true

# -----------------------------------------------------------------------------
# Monitoring (Prometheus)
# -----------------------------------------------------------------------------
monitoring:
  enabled: true
  # ServiceMonitor settings
  interval: 30s
  scrapeTimeout: 10s
  # Grafana Dashboard
  dashboard:
    enabled: true
    namespace: monitoring  # Where Grafana is deployed

# -----------------------------------------------------------------------------
# Sealed Secrets (GitOps-managed secrets)
# -----------------------------------------------------------------------------
# These encrypted values can only be decrypted by the sealed-secrets controller
# in the target cluster. To rotate secrets:
#   1. kubectl create secret ... | kubeseal --format yaml > sealed.yaml
#   2. Copy the encryptedData value here
# -----------------------------------------------------------------------------
sealedSecrets:
  enabled: true

  postgres:
    # Encrypted with cluster's sealed-secrets public key
    encryptedPassword: AgCpj0qORnGpmDlR6GdAS8UMaL7th/Ua4jzvEgy12QAhlAUx4nUOoHfwv16c/bKPXK8siYtOfsrfPFiFQWY63F/45U48wk0/i1xQGf7ELbD8xK2L6iUwaQz/Rw/6VUp4GJk3O6Bl5qq6NirdQjzCu/d+XYDG9fvXdvLdh7oS8evUpDU/Js0g8EsmLeo4v/ebGOAEnQJ/VxAVnOf4h+shNCUHoaMWrE9/WV+IUnw92ML0Kuk82bIEndrmxASLYoPB9FaCy7bMMHfP7tL5pG7b/UqnUhmxk7219E64NGWgj6iWJ35XELGw4+NjDLvkW0IIAT6jpKHTAqbE7Sq+kJlEPSD2eLIeBrypXTBeSlEIjmVyxa0FE0uhx9OnJENKP4PKIaV/qPR9T6QxunuDwe2SD6JRNZ6LvufoxUQXderop89ph97EPGfXcD+NQUS6OHtrDHDivfjd9avBcWc2BZAkTYPwM108IFXtjm2rgyo54k3B8kJ5HRL1KXzXOBaFMPfOlD7G94XspXIRMypPXUJ3k3sKE6i9xz3lLXrtI42kSqmJw3FfYWFnot6S03Cof2tIxrsQ4o+2ZzzPozik5NqP01W9Y2u4USTTddc5EuNwVYCP+mnJz8jpdfCq0Rbj3CJJJmVmhoq3m0WKJ9YSAJtVkxhvpDvrt1eijjO9iUAw2zCHzy+j08CPMAam1kehq7jR/zxQvwOy7QmTNPUBjpXUuU8eXTLaF1BD+iIMPgkBZTTv

  redis:
    # Encrypted with cluster's sealed-secrets public key
    encryptedPassword: AgAYlOjlnpWk7TWJTvdQjhOXu4ArA5iyWQ1AjTpZD4xDho6BkDKjX4gyZlOVjarj2fZL6UqebHw9llLDDxZrHAFWrTQrT7h27PcC/1HCdUsWTUb+BNhDznKtAVzsysS6oMJUMMJLsobfz+R27wMEzXZL1pV2rvy2yvlxaIyz+KzLssZRyezgguS+kMeoOgc5gu/6oQTLM9QrO91cEFw/QXgnnrc93T4GTFKIXfsSwWhv2pZPR1PV0SohaTzcTjQe8/HfwZQOb/m7NeBeBDRxJ6c8L5YLmt0DjjukN8UkBmO6pqsRCRnImUTxYlXug6HQIpFYHERt/20HvzdSwIbuN4MLNTLfaihJVvWRTzFkX7+EMn4uwG3zi/JFuK5RTMUGdxuo2+eAeC6OJpJV+hTdWaeUec8etRYAAtkmNos3oPM6oAZTCH/CyohAZeZw28ha1xo2azvt0KwUJoonbV2ixyX5aL3CgPEVVLqqfWbrE8hkof0x+WNWpATUuAMmPkFXMuFtGjk1ScRbNU05EaY37vv7jtRC18Umtpv+VFuDwCpI48aqrTMPJ56og6QsNeTL0HU9NVwRxGkB1X7gtemsMB9HEogh8Yc/i6oJ7RIRsRPj8DEx1yc1/QBULdxjAOnHawadvATz77OzgazltR7fJ/PXuG5Heq6dUSNEVDwSaUUh9gLm/MIV2AQ83I118YL2uxelXPUxsgFCeBCaPra1QQm9cTdOG1lugWvVvrarYKzP

  ghcr:
    # Encrypted Docker config for GHCR registry
    encryptedDockerConfig: AgCO/ZXMaMGO/6BWbSDZdRU3SwcFeCpS92WHEr/dtUzSgCHNOFzBta+jf+XN8RWciQ9Sb2pH21Lg7+7lW5Xn1O2xG4AnYtmnPbJIAbO9uoPI4R0R9XEBnPTGGNjxrbnCp3q48VKWGaV5fgkTuu8gbPcX/231WTEbZClmMzlFB8vR6SyUmKDSvZdpC9emIppP3jr8QUxFQUNv3YLX1Jp0+xAUVi0RVjOwMgaIA2wps98zdxQA7fQa/9ERZ0ORm9pTE6ycqaZNkT+w/3jNJ+64cD6CM5ONhbGGeDUyYB6rVbtirxfjiSS4HPjyqAHutnYKNVGsLLnHhwzbXg2xTp+jODm1JUor4Q0XkV8GKkEgAx3RCKVwcKJ/EWljIgJLfR6pMtL9tsUAgitPCFVmm2KeOz8WBsgQ2pbh4/1BmoLtSy8dz2INo0HmHqr3SzVni6QGCN5t1crVwk3NGLHClT4THcCs4JBARQkuZJ9rBJgglYqFx2PcQWfAnnAuagthrsDrx3EpJbV9uoD1xj1qXrM5ap/416rBNMkn4OWa+kRpq0qCNxwFeKPI+VJuvtZiVyleHzNr6hKgWTi/FbHmkltdCe3QKh9ipvRoiViqZrOxfykTwiuLiLewXBu5u57cOJZ4ZYS5Uf5iH/3MhKPfGZGjNnZHMonssVnQfJd77p7EXrcwIrEe2Q4z/l408KfrgAI4i3DKOdLV3t/nKYwydUJ9ZiBqoPELYNp0wyMopOd4kziArQU0LNpw6g8i9OdTr8MeWqI8elMckPUa/uSjIuVf4ALGiQLLHcWEDrQfGhWf2JydEZsuwqGtzVh75xpRX3IjQwbGEr0GAPZBwQi0Co0JMig/iwTLPFJrspV3NB/EEvOtp7OO7114/Bp02JEIRgzD8bxARXHnnKh9ZtqXNx8qeVU4mECN2YRKIV1vyTkL/gY0F/8=

# -----------------------------------------------------------------------------
# ArgoCD Notifications
# -----------------------------------------------------------------------------
notifications:
  enabled: true
  discord:
    # Encrypted with sealed-secrets
    encryptedWebhookUrl: AgAtNtaSySBJ5/jgE60ShbR2fHkEzg2MTEF1YXI0rAG1FoPU2bUDKFjtcJOxx19vdwhrVDV7VP0al2+sVuh3FyJo+uMyWfzL1iE9TywvkWO5muFJiU5OzxedhRjH4fAUKMvzE8PY7WwqEqHL9P+KpTu+DPGXKlxEDkj8bJas/k6P8ID4ANLPUTtw5m2g7oCRJNLmisfhNw4/AqObDQJpF/Bt5FCB13fe7+tKYVdWMRbXgPLjNObfjCj8+9j+4tMMqAz7gITQi3vPz018xM3t+HZv49ONtcAhELvhteG0vYuHhA8wpJuOg8tEs4AGEuD9gLCgWXGnfw/NiseGTpWz+QtALHScNwvyJyNRaIq662xlCzdCPs+/TbKVVB1epn5fEjHeeXl2SzoozjoAIxJtnCsBfr81Y0ewgxf/tnDi2TXMxzm0lFaMlvV5WrVy9C2Uap5MMlonpxvkvEzmwTWt49sSSDS2XFvllKbUjQ8tzmdIQplGUeEgZINOMBevL4F10DQ0T9F8lDOg41DWcqoomk6z8w9UkCgy4Gj4s3uEkMla7qo/nrhCPrUnTJCMaaAdG+XmvPJe6n78xV27mGLoRdfFGTLWktYtu1w95DjJOuH1sqbiOIvQquMM0zJ+2CT7qRCOLqd+DFgoGTXM9rpeT8eM/vikGlhZWcu3oLEZSn+bDCWP0/5O3YRBThce0s7/nwnr0ZTRPR/HINDMOU9N2ZHFQig+VxzkTXby2zQ8BmSGSRYH2UA/68vjyOZKl1RJIHdCQQDGM7zlYCLSo1TE/Y9jDvXEF/8JtVSLyeoNx9oPLgfOaW37Uj0DANxYgR8B+C2H/mPnLUcmGjtXJYgDUVN8pYPUi0AI4H6H

# -----------------------------------------------------------------------------
# Backend (Go API Server)
# -----------------------------------------------------------------------------
backend:
  # Number of replicas - CHANGE THIS TO TEST SCALING
  replicaCount: 2

  image:
    repository: ghcr.io/mvulcu/maria-guestbook-backend
    tag: "a5f2dbf"  # backend-tag (auto-updated by CI)
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 8080

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 8080
    initialDelaySeconds: 10
    periodSeconds: 15

  readinessProbe:
    httpGet:
      path: /health
      port: 8080
    initialDelaySeconds: 3
    periodSeconds: 5

  # Environment variables
  env:
    redisHost: maria-redis
    redisPort: "6379"
    dbHost: maria-postgres
    dbPort: "5432"
    dbUser: guestbook
    dbName: guestbook

# -----------------------------------------------------------------------------
# Frontend (Nginx)
# -----------------------------------------------------------------------------
frontend:
  # Number of replicas - CHANGE THIS TO TEST SCALING
  replicaCount: 2

  image:
    repository: ghcr.io/mvulcu/maria-guestbook-frontend
    tag: "a5f2dbf"  # frontend-tag (auto-updated by CI)
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 8080

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Health check
  readinessProbe:
    httpGet:
      path: /
      port: 8080
    initialDelaySeconds: 3
    periodSeconds: 5

# -----------------------------------------------------------------------------
# PostgreSQL (Database)
# -----------------------------------------------------------------------------
postgresql:
  enabled: true

  image:
    repository: postgres
    tag: "15-alpine"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  auth:
    enabled: true
    username: guestbook
    database: guestbook
    # password: "password" # Removed for security, using existingSecret
    existingSecret: maria-postgres-secret
    existingSecretPasswordKey: password

  # Backup settings
  backup:
    enabled: true
    # Cron schedule: Daily at 2:00 AM
    schedule: "0 2 * * *"
    # Keep last 7 backups
    retention: 7
    # PersistentVolume for backup storage
    persistentVolume:
      enabled: false  # Set to true for production

# -----------------------------------------------------------------------------
# Redis (Cache)
# -----------------------------------------------------------------------------
redis:
  enabled: true

  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  # Redis authentication
  auth:
    enabled: true
    # Password is stored in secret, not here
    existingSecret: maria-redis-secret
    existingSecretPasswordKey: password

# -----------------------------------------------------------------------------
# Ingress
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: nginx

  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"

  host: maria-guestbook.cicd.cachefly.site

  tls:
    enabled: true
    secretName: maria-guestbook-tls

# -----------------------------------------------------------------------------
# Autoscaling (HPA)
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false  # Disabled for predictable testing
  # enabled: true
  # minReplicas: 2
  # maxReplicas: 10
  # targetCPUUtilizationPercentage: 70
  # targetMemoryUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# Pod Disruption Budget
# -----------------------------------------------------------------------------
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  name: maria-guestbook-sa
  annotations: {}

# -----------------------------------------------------------------------------
# Security Context
# -----------------------------------------------------------------------------
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# -----------------------------------------------------------------------------
# Node Affinity / Tolerations (optional)
# -----------------------------------------------------------------------------
nodeSelector: {}
tolerations: []
affinity: {}



